<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Storage Bridge</title>
</head>
<body>
  <script>
    /**
     * Cross-Domain localStorage Bridge
     * Bu sayfa guzellestir.com'da host edilir ve tüm subdomain'ler buraya erişir
     */
    
    (function() {
      // İzin verilen origin'ler (güvenlik için)
      const ALLOWED_ORIGINS = [
        'https://guzellestir.com',
        'https://kardesler.guzellestir.com',
        'https://lezzet.guzellestir.com',
        'http://localhost:3000',
        'http://localhost:3001'
      ];

      // Origin kontrolü
      function isOriginAllowed(origin) {
        // Tüm .guzellestir.com subdomain'lerini kabul et
        if (origin.endsWith('.guzellestir.com')) return true;
        return ALLOWED_ORIGINS.includes(origin);
      }

      // Message handler
      window.addEventListener('message', function(event) {
        // Güvenlik kontrolü
        if (!isOriginAllowed(event.origin)) {
          console.warn('Unauthorized origin:', event.origin);
          return;
        }

        const { method, key, value, requestId } = event.data;

        try {
          let result;

          switch (method) {
            case 'getItem':
              result = localStorage.getItem(key);
              break;

            case 'setItem':
              localStorage.setItem(key, value);
              result = { success: true };
              break;

            case 'removeItem':
              localStorage.removeItem(key);
              result = { success: true };
              break;

            case 'clear':
              localStorage.clear();
              result = { success: true };
              break;

            case 'getAllKeys':
              result = Object.keys(localStorage);
              break;

            default:
              throw new Error('Unknown method: ' + method);
          }

          // Sonucu geri gönder
          event.source.postMessage({
            requestId: requestId,
            result: result,
            error: null
          }, event.origin);

        } catch (error) {
          // Hata durumunda
          event.source.postMessage({
            requestId: requestId,
            result: null,
            error: error.message
          }, event.origin);
        }
      });

      // Bridge hazır olduğunu bildir
      window.parent.postMessage({ ready: true }, '*');
      
      console.log('Storage Bridge initialized');
    })();
  </script>
</body>
</html>
